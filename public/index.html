<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Welcome to Firebase Hosting</title>
	
		<!-- The core Firebase JS SDK is always required and must be listed first -->

		<!-- update the version number as needed -->
		<script src="/__/firebase/7.19.0/firebase-app.js"></script>
		<!-- include only the Firebase features as you need -->
		<script src="/__/firebase/7.19.0/firebase-auth.js"></script>
		<script src="/__/firebase/7.19.0/firebase-database.js"></script>
		<script src="/__/firebase/7.19.0/firebase-messaging.js"></script>
		<script src="/__/firebase/7.19.0/firebase-storage.js"></script>
		<script src="/__/firebase/7.19.0/firebase-firestore.js"></script>
		<!-- initialize the SDK after all desired features are loaded -->

		<link rel="stylesheet" type="text/css" href="./index.css">	
		<meta name="description" content="A collection of highlights and notes from books and articles.">

	</head>
	<body>
		<div id="root">
			<main id="main" class="l-container l-container--shelf u-margin-top--xl">
				<h1 class="u-antialiased">What Iâ€™ve been reading</h1>
				<ul class="c-shelf">
				</ul>
			</main>
		</div>
	</body>


	<!-- Import the firebase configuration and initialize -->

	<script src="./FirebaseConfig.js"></script>	

	<script>

		function render(volumes) {
			let shelf = document.getElementsByClassName("c-shelf")[0];

			volumes.forEach(volume => {
				let li = document.createElement('LI');
				let text = document.createElement('H2');
				let img = document.createElement('IMG');
				let link = document.createElement('A');
				let figure = document.createElement('FIGURE');

				li.classList.add("c-shelf__volume")
				text.innerHTML = volume.book.title.split(':')[0];
				text.classList.add("c-shelf__volume__title");
				img.src = `covers/${volume.book.ISBN[1].identifier}.jpg`;
				link.classList.add("c-shelf__link");
				figure.classList.add("c-cover");

				figure.appendChild(img);
				link.appendChild(figure);
				link.appendChild(text);
				li.appendChild(link);
				shelf.appendChild(li);
			});

		}

		function sortBooks(volumes) {
			console.log(volumes)

			volumes.sort((a, b) => { 
				if ( a.sync && b.sync) 
				{
					return new Date(a.sync) - new Date(b.sync)
				} 
				else if (a.sync) 
				{
					return -1
				}
				else if (b.sync) 
				{
					return 1
				}

				return 0;
			});

			console.log(volumes)

			return volumes;
		}

		function parse(doc) {
			const result = [];
			doc.forEach((doc) => { 
				result.push(doc.data()) 
			});
			return result;
		}


		function getVolumes() {
			const myData = firebase
			.firestore()
			.collection("volumes")
			.get()
				.then(parse)
				.then(sortBooks)
				.then(render)
		}

	getVolumes();
	</script>

</html>

